<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configuración de IA — Clean pay</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{ --brand:#1463ff; --text:#0a0a0a; --muted:#6b7280; --border:#e5e7eb; --bg:#fff; --purple:#ff00ff;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text); background:var(--bg)}
    a{color:inherit; text-decoration:none}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}

    /* NAV */
    .nav{height:72px; border-bottom:1px solid var(--border); position:sticky; top:0; background:#fff; z-index:10}
    .nav__inner{display:flex; align-items:center; height:100%}
    .nav__logo{display:flex; align-items:center; gap:10px; margin-right:22px}
    .logo{width:28px; height:28px; border-radius:50%; display:grid; place-items:center; color:#fff; font-weight:800; background:var(--brand)}
    .brand{font-size:1.25rem; font-weight:800}
    .nav__spacer{flex:1}
    .pill{display:inline-block; background:#000; color:#fff; font-weight:900; padding:10px 14px; border-radius:999px; text-decoration:none}

    /* Cabecera azul */
    .head-blue{ background:var(--brand); color:#ffffff; padding:18px 16px; border-radius:12px; margin:26px 0 12px; }
    .title{font-size:clamp(34px,5vw,56px); line-height:1.05; font-weight:900; margin:0}
    .sub{color:var(--muted); margin:6px 0 14px}

    /* Panel */
    .panel{ border:px solid var(--border); border-radius:16px; background:#fff; padding:22px; display:grid; gap:16px }
    .label{ font-weight:800; font-size:32px;line-height:74px ;}
    .purple{color:var(--purple)}
    /* Chips multiselección */
    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-top:6px }
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
      border:1px solid var(--border); border-radius:999px; cursor:pointer; user-select:none; background:#fff;
      transition:background .2s ease, border-color .2s ease;
      font-weight:800;
    }
    .chip input{ appearance:none; width:16px; height:16px; border:2px solid #cbd5e1; border-radius:4px; display:inline-block; position:relative }
    .chip input:checked{ border-color:var(--brand); background:var(--brand) }
    .chip input:checked::after{ content:""; position:absolute; inset:2px; border:2px solid #fff; border-top-color:transparent; border-left-color:transparent; transform:rotate(45deg) }
    .chip.active{ border-color:var(--brand); background:rgba(20,99,255,.06) }

    /* Umbral + botón Aceptar */
    .block{ display:block } /* siempre visible */
    .threshold{ display:flex; flex-direction:column; align-items:flex-start; gap:12px; margin-top:10px }
    .field{ display:flex; flex-direction:column; gap:10px }
    select{ padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-weight:600; min-width:220px }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:#000; color:#fff; font-weight:900; cursor:pointer;
      transition:transform .08s ease, opacity .2s ease; margin-top:2px;
    }
    .btn:active{ transform:scale(.98) }
    .saved{ margin-top:6px; color:#16a34a; font-weight:800; display:none; }
    .saved.show{ display:block }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container nav__inner">
      <a class="nav__logo" href="/">
        <div class="logo">Bs</div>
        <div class="brand">Clear P<span class="purple">AI</span></div>
      </a>
      <div class="nav__spacer"></div>
      <a href="/clear-pay.html" class="pill">← Atrás</a>
    </div>
  </div>

  <!-- Contenido -->
  <section>
    <div class="container">
      <div class="head-blue">
        <h1 class="title">Configuración de Clear PAI</h1>
      </div>
      <p class="sub">Elige tus preferencias de notificación y tu umbral.</p>

      <div class="panel">
        <!-- Bloque SIEMPRE visible: canales + umbral + aceptar -->
        <div id="optsBlock" class="block" aria-live="polite">
          <div class="field">
            <span class="label">¿Por dónde te notificamos?</span>
            <div class="chips" id="chips">
              <label class="chip" data-key="sms"><input type="checkbox" value="sms"> SMS</label>
              <label class="chip" data-key="email"><input type="checkbox" value="email"> Email</label>
              <label class="chip" data-key="app"><input type="checkbox" value="app"> App Sabadell</label>
            </div>
          </div>

          <div class="threshold">
            <div class="field">
              <span class="label">Dime tu umbral</span>
              <select id="umbral">
                <option value="bajo">bajo</option>
                <option value="medio" selected>medio</option>
                <option value="alto">alto</option>
              </select>
            </div>

            <button id="btnSave" class="btn">Aceptar</button>
            <div id="savedMsg" class="saved">Se ha guardado correctamente</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Estado a guardar
    let umbralSeleccionado = null;
    let canalesSeleccionados = []; // array de strings

    // Elementos UI
    const $umbral = document.getElementById('umbral');
    const $btnSave = document.getElementById('btnSave');
    const $savedMsg = document.getElementById('savedMsg');
    const $chips = document.getElementById('chips');

    // Init desde localStorage
    (function initFromStorage(){
      const u = localStorage.getItem('cfg_umbral');
      const c = localStorage.getItem('cfg_canales'); // JSON

      // Mantén cfg_notif=true para el resto de la app (ya no hay toggle)
      localStorage.setItem('cfg_notif', 'true');

      if (u) {
        umbralSeleccionado = u;
        $umbral.value = u;
      }
      if (c) {
        try { canalesSeleccionados = JSON.parse(c) || []; } catch { canalesSeleccionados = []; }
      }

      // marcar chips según lo guardado
      if (canalesSeleccionados.length) {
        canalesSeleccionados.forEach(key => {
          const chip = $chips.querySelector(`[data-key="${key}"]`);
          if (chip) {
            chip.classList.add('active');
            const input = chip.querySelector('input');
            if (input) input.checked = true;
          }
        });
      }
    })();

    // Gestión de chips (multiselección)
    $chips.addEventListener('change', (e) => {
      const inp = e.target;
      if (!(inp instanceof HTMLInputElement)) return;
      const key = inp.value;
      const chip = inp.closest('.chip');
      if (inp.checked) {
        chip?.classList.add('active');
        if (!canalesSeleccionados.includes(key)) canalesSeleccionados.push(key);
      } else {
        chip?.classList.remove('active');
        canalesSeleccionados = canalesSeleccionados.filter(k => k !== key);
      }
      $savedMsg.classList.remove('show');
    });

    // Guardar todo
    $btnSave.addEventListener('click', () => {
      umbralSeleccionado = $umbral.value;
      localStorage.setItem('cfg_umbral', umbralSeleccionado || '');
      localStorage.setItem('cfg_canales', JSON.stringify(canalesSeleccionados || []));
      localStorage.setItem('cfg_notif', 'true'); // siempre activado
      $savedMsg.classList.add('show');
      // location.href = '/clean-pay.html'; // si quieres volver automáticamente
    });
  </script>
</body>
</html>
